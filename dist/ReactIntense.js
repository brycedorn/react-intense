"use strict";var _react=_interopRequireWildcard(require("react"));Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;require("./polyfills.js");function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!=f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}const defaultProps={invert:!1,moveSpeed:.05,vertical:!1},KEYCODE_ESC=27;class ReactIntense extends _react.Component{constructor(a){super(a);const{innerWidth:b,innerHeight:c}=window,{body:d}=document;this.state={bindingsApplied:!1,container:{width:b,height:c},lastPosition:0,loaded:!1,mouseDest:{x:0,y:0},mouseCurr:{x:b/2,y:c/2},overflow:{x:0,y:0},overflowValue:d&&d.style.overflow||"unset",target:{width:0,height:0},visible:!1},this.setDimensions=this.setDimensions.bind(this),this.positionTarget=this.positionTarget.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.removeEventListeners=this.removeEventListeners.bind(this),this.loop=this.loop.bind(this),this._onClick=this._onClick.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onLoad=this._onLoad.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this.hideViewer=this.hideViewer.bind(this)}setDimensions(a){const{offsetHeight:b,offsetWidth:c}=a;this.setState({overflow:{x:this.state.container.width-c,y:this.state.container.height-b}})}positionTarget(){var a=Math.abs;const{mouseCurr:b,mouseDest:c}=this.state,{moveSpeed:d}=this.props,e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d,g=a(e-b.x)+a(f-b.y);if(1e-4<g){this.setState({mouseCurr:{x:e,y:f}});const{container:a,lastPosition:b,overflow:c}=this.state,{vertical:d}=this.props;if(d){if(f!==b){const b=this.calcPosition(f,a.height),d=c.y*b;this.setState({lastPosition:f,transform:"translate3d( 0px, "+d+"px, 0px)"})}}else if(e!==b){const b=this.calcPosition(e,a.width),d=c.x*b;this.setState({lastPosition:e,transform:"translate3d("+d+"px, 0px, 0px)"})}}}calcPosition(a,b){return this.props.invert?(b-a)/b:a/b}addEventListeners(){try{const a=this.refs.container,b=a.children[0].children[0];b.addEventListener("mousemove",this._onMouseMove),b.addEventListener("touchmove",this._onTouchMove),b.addEventListener("click",this.hideViewer),window.addEventListener("resize",this.setDimensions),window.addEventListener("keyup",this._onKeyUp),this.setState({bindingsApplied:!0})}catch(a){}}removeEventListeners(){try{const a=this.refs.container,b=a.children[0].children[0];b.removeEventListener("mousemove",this._onMouseMove),b.removeEventListener("touchmove",this._onTouchMove),b.removeEventListener("click",this.hideViewer),window.removeEventListener("resize",this.setDimensions),window.removeEventListener("keyup",this._onKeyUp),this.setState({bindingsApplied:!1})}catch(a){}}componentDidMount(){this.positionTarget()}componentWillUnmount(){this.state&&this.state.bindingsApplied&&this.removeEventListeners()}lockBody(){document.body&&(document.body.style.overflow="hidden")}unlockBody(){document.body&&this.state.overflowValue&&(document.body.style.overflow=this.state.overflowValue)}stop(a){window.cancelAnimationFrame(a)}loop(){const a=window.requestAnimationFrame(this.loop);this.setState({looper:a}),this.positionTarget()}_onClick(a){a.preventDefault(),this.props.onClick&&this.props.onClick(),this.setState({visible:!0}),this._onMouseMove.call(void 0,a),this.lockBody(),this.loop()}_onKeyUp(a){a.preventDefault(),a.keyCode===KEYCODE_ESC&&this.hideViewer()}_onLoad(a){this.setState({loaded:!0,source:{src:this.props.src,width:a.target.offsetWidth,height:a.target.offsetHeight}}),this.setDimensions.call(void 0,a.target),this.addEventListeners()}_onMouseMove(a){this.setState({mouseDest:{x:a.clientX,y:a.clientY}})}_onTouchMove(a){a.preventDefault(),this.setState({mouseDest:{x:a.touches[0].clientX,y:a.touches[0].clientY}})}hideViewer(){this.setState({visible:!1}),this.stop(this.state.looper),this.unlockBody(),this.removeEventListeners()}_renderLoader(a,b){return b&&a?_react.default.createElement("div",{className:`${a} ri-loader`},[...Array(8)].map((a,b)=>_react.default.createElement("div",{key:`${b}-outer`},_react.default.createElement("div",{key:`${b}-inner`})))):_react.default.createElement("div",null)}_renderViewer(){const{container:a,loaded:b,transform:c,visible:d}=this.state,{height:e,width:f}=a,{caption:g,src:h,title:i}=this.props,j={height:this.props.vertical?"":e,MozTransform:c,transform:c,WebkitTransform:c,width:this.props.vertical?f:""};return d?_react.default.createElement("div",{ref:"container"},_react.default.createElement("figure",{className:"ri-container",style:{opacity:b?1:0}},_react.default.createElement("img",{src:h,style:j,onLoad:this._onLoad}),_react.default.createElement("figcaption",{className:"ri-caption-container"},_react.default.createElement("h1",{className:"ri-title"},i),_react.default.createElement("h2",{className:"ri-caption"},g)))):_react.default.createElement("div",{ref:"container"})}render(){const{className:a,loader:b,src:c,thumbnailSrc:d,trigger:e}=this.props,{visible:f}=this.state,g={children:this._renderLoader(b,f),className:(a||"ri-trigger")+(f?" clicked":""),onClick:this._onClick,style:{backgroundImage:"url("+(d||c)+")"}},h=e?_react.default.createElement("trigger",g):_react.default.createElement("a",g);return _react.default.createElement("div",{className:"ri-wrapper"},h,this._renderViewer())}}exports.default=ReactIntense,ReactIntense.defaultProps=defaultProps;