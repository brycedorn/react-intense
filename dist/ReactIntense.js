import React,{Component}from"react";import"./polyfills.js";const defaultProps={invert:!1,moveSpeed:.05,vertical:!1},KEYCODE_ESC=27;export default class ReactIntense extends Component{constructor(a){super(a);const{innerWidth:b,innerHeight:c}=window,{body:d}=document;this.state={bindingsApplied:!1,container:{width:b,height:c},lastPosition:0,loaded:!1,mouseDest:{x:0,y:0},mouseCurr:{x:b/2,y:c/2},overflow:{x:0,y:0},overflowValue:d&&d.style.overflow||"unset",target:{width:0,height:0},visible:!1},this.setDimensions=this.setDimensions.bind(this),this.positionTarget=this.positionTarget.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.removeEventListeners=this.removeEventListeners.bind(this),this.loop=this.loop.bind(this),this._onClick=this._onClick.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onLoad=this._onLoad.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this.hideViewer=this.hideViewer.bind(this)}setDimensions(a){const{offsetHeight:b,offsetWidth:c}=a;this.setState({overflow:{x:this.state.container.width-c,y:this.state.container.height-b}})}positionTarget(){var a=Math.abs;const{mouseCurr:b,mouseDest:c}=this.state,{moveSpeed:d}=this.props,e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d,g=a(e-b.x)+a(f-b.y);if(1e-4<g){this.setState({mouseCurr:{x:e,y:f}});const{container:a,lastPosition:b,overflow:c}=this.state,{vertical:d}=this.props;if(d){if(f!==b){const b=this.calcPosition(f,a.height),d=c.y*b;this.setState({lastPosition:f,transform:"translate3d( 0px, "+d+"px, 0px)"})}}else if(e!==b){const b=this.calcPosition(e,a.width),d=c.x*b;this.setState({lastPosition:e,transform:"translate3d("+d+"px, 0px, 0px)"})}}}calcPosition(a,b){return this.props.invert?(b-a)/b:a/b}addEventListeners(){try{const a=this.refs.container,b=a.children[0].children[0];b.addEventListener("mousemove",this._onMouseMove),b.addEventListener("touchmove",this._onTouchMove),b.addEventListener("click",this.hideViewer),window.addEventListener("resize",this.setDimensions),window.addEventListener("keyup",this._onKeyUp),this.setState({bindingsApplied:!0})}catch(a){}}removeEventListeners(){try{const a=this.refs.container,b=a.children[0].children[0];b.removeEventListener("mousemove",this._onMouseMove),b.removeEventListener("touchmove",this._onTouchMove),b.removeEventListener("click",this.hideViewer),window.removeEventListener("resize",this.setDimensions),window.removeEventListener("keyup",this._onKeyUp),this.setState({bindingsApplied:!1})}catch(a){}}componentDidMount(){this.positionTarget()}componentWillUnmount(){this.state&&this.state.bindingsApplied&&this.removeEventListeners()}lockBody(){document.body&&(document.body.style.overflow="hidden")}unlockBody(){document.body&&this.state.overflowValue&&(document.body.style.overflow=this.state.overflowValue)}stop(a){window.cancelAnimationFrame(a)}loop(){const a=window.requestAnimationFrame(this.loop);this.setState({looper:a}),this.positionTarget()}_onClick(a){a.preventDefault(),this.props.onClick&&this.props.onClick(),this.setState({visible:!0}),this._onMouseMove.call(void 0,a),this.lockBody(),this.loop()}_onKeyUp(a){a.preventDefault(),a.keyCode===KEYCODE_ESC&&this.hideViewer()}_onLoad(a){this.setState({loaded:!0,source:{src:this.props.src,width:a.target.offsetWidth,height:a.target.offsetHeight}}),this.setDimensions.call(void 0,a.target),this.addEventListeners()}_onMouseMove(a){this.setState({mouseDest:{x:a.clientX,y:a.clientY}})}_onTouchMove(a){a.preventDefault(),this.setState({mouseDest:{x:a.touches[0].clientX,y:a.touches[0].clientY}})}hideViewer(){this.setState({visible:!1}),this.stop(this.state.looper),this.unlockBody(),this.removeEventListeners()}_renderLoader(a,b){return b&&a?React.createElement("div",{className:`${a} ri-loader`},[...Array(8)].map((a,b)=>React.createElement("div",{key:`${b}-outer`},React.createElement("div",{key:`${b}-inner`})))):React.createElement("div",null)}_renderViewer(){const{container:a,loaded:b,transform:c,visible:d}=this.state,{height:e,width:f}=a,{caption:g,src:h,title:i}=this.props,j={height:this.props.vertical?"":e,MozTransform:c,transform:c,WebkitTransform:c,width:this.props.vertical?f:""};return d?React.createElement("div",{ref:"container"},React.createElement("figure",{className:"ri-container",style:{opacity:b?1:0}},React.createElement("img",{src:h,style:j,onLoad:this._onLoad}),React.createElement("figcaption",{className:"ri-caption-container"},React.createElement("h1",{className:"ri-title"},i),React.createElement("h2",{className:"ri-caption"},g)))):React.createElement("div",{ref:"container"})}render(){const{className:a,loader:b,src:c,thumbnailSrc:d,trigger:e}=this.props,{visible:f}=this.state,g={children:this._renderLoader(b,f),className:(a||"ri-trigger")+(f?" clicked":""),onClick:this._onClick,style:{backgroundImage:"url("+(d||c)+")"}},h=e?React.createElement("trigger",g):React.createElement("a",g);return React.createElement("div",{className:"ri-wrapper"},h,this._renderViewer())}}ReactIntense.defaultProps=defaultProps;

